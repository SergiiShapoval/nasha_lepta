"use strict";angular.module("nashaLeptaApp").directive("nlArticle",function(){return{templateUrl:"templates/directives/nl-article.html",restrict:"E",scope:{data:"@",auth:"="},controller:"NlArticleCtrl"}}),angular.module("nashaLeptaApp").controller("AuthCtrl",["$scope","$rootScope","$firebaseAuth","FirebaseLink",function(a,b,c,d){var e=new Firebase(d);b.auth=c(e),a.isShowLogin=!1,a.signIn=function(){b.auth.$authWithPassword({email:a.email,password:a.password}).then(function(a){b.auth.user=a.password})["catch"](function(a){console.error("Authentication failed:",a)})},a.logOut=function(){b.auth.$unauth(),b.auth.user=null},a.showLogin=function(){a.isShowLogin=!a.isShowLogin}}]),angular.module("nashaLeptaApp").controller("NlArticleCtrl",["$scope","editorOptions","$sce","IsNeedToCompileFurther","FirebaseLink","$firebaseObject",function(a,b,c,d,e,f){a.editorOptions=b,f(new Firebase(e+"/"+a.data)).$loaded().then(function(b){var e=b.$value;a.toEdit=b,d(e)?(a.toShow=null,a.toShowCompile=e):(a.toShow=c.trustAsHtml(e),a.toShowCompile=null)})["catch"](function(a){console.error("Error:",a)}),a.edit=function(){a.isEdit=!0,a.isPreview=!1},a.preview=function(){a.isPreview=!0;var b=a.toEdit.$value;d(b)?(a.toShow=null,a.toShowCompile=b):(a.toShow=c.trustAsHtml(b),a.toShowCompile=null)},a.save=function(){a.toEdit.$save(),a.toShow=c.trustAsHtml(a.toEdit.$value),a.isEdit=!1}}]),angular.module("nashaLeptaApp").constant("editorOptions",{language:"ru",allowedContent:!0,entities:!1,extraPlugins:"image2,youtube,justify,font,embed,find,iframe,table,tableresize,tabletools,clipboard,liststyle,selectall,uicolor,colorbutton,dialogui,dialog,lineutils,showblocks,autolink,widget,widgetbootstrap,widgettemplatemenu",toolbar:"full",toolbar_full:[{name:"base",items:["Bold","Italic","Underline","ShowBlocks"]},{name:"paragraph",items:["NumberedList","BulletedList","-","Outdent","Indent","-","Blockquote"]},{name:"support",items:["JustifyLeft","JustifyCenter","JustifyRight","JustifyBlock"]},{name:"editing",items:["Find","Replace","-","SelectAll"]},{name:"links",items:["Link","Unlink","Anchor"]},{name:"clipboard",items:["Cut","Copy","Paste","HorizontalRule"]},{name:"UnRe",items:["Undo","Redo"]},{name:"styles",items:["Styles","Font","Format","FontSize"]},{name:"styles",items:["PasteText","PasteFromWord","RemoveFormat"]},{name:"colors",items:["TextColor","BGColor"]},{name:"insert",items:["Image","Table","SpecialChar"]},{name:"video",items:["Youtube"]},{name:"others",items:["Source"]},{name:"tools",items:["Maximize"]},{name:"bootstrap",items:["WidgetTemplateMenu"]}]}),angular.module("nashaLeptaApp").controller("AdminRoutesCtrl",["$scope","$route",function(a,b){a.routes=b.routes}]),$(function(){$.fn.scrollToTop=function(){$(this).hide().removeAttr("href"),"0"!=$(window).scrollTop()&&$(this).fadeIn("slow");var a=$(this);$(window).scroll(function(){"0"==$(window).scrollTop()?$(a).fadeOut("slow"):$(a).fadeIn("slow")}),$(this).click(function(){$("html, body").animate({scrollTop:0},"slow")})}}),$(function(){$("#toTop").scrollToTop()});var date=new Date;document.getElementById("currentYear").innerHTML=date.getFullYear(),angular.module("nashaLeptaApp").directive("compile",["$compile",function(a){return function(b,c,d){b.$watch(function(a){return a.$eval(d.compile)},function(d){c.html(d),c.addClass("nl-description"),a(c.contents())(b)})}}]),angular.module("nashaLeptaApp").controller("CarouselCtrl",["$scope",function(a){a.myInterval=5e3,a.noWrapSlides=!1}]),angular.module("nashaLeptaApp").controller("MainCtrl",["$rootScope","$location","Lightbox","$uibModal",function(a,b,c,d){a.location=function(){return b.path()},a.openLightboxModal=function(a){var b=[a];console.log(b),c.keyboardNavEnabled=!1,c.openModal(b,0)},a.openMap=function(){d.open({animation:!0,templateUrl:"templates/pages/map.html",size:"lg"})}}]),angular.module("nashaLeptaApp").directive("nlRandomGroup",function(){return{templateUrl:"templates/directives/nl-random-group.html",restrict:"E",link:function(a,b,c){},controller:["$scope",function(a){var b=0;this.assignNumber=function(){return b++};var c=Math.floor(1e3*Math.random()+1);console.log("currentRandom: "+c),this.getCounter=function(){return b},this.getCurrentRandom=function(){return c},a.$on("$routeChangeStart",function(a,b){c++,console.log("currentRandom: "+c)})}]}}),angular.module("nashaLeptaApp").constant("FirebaseLink","https://boiling-fire-9518.firebaseio.com"),angular.module("nashaLeptaApp").directive("nlRandomAlbum",function(){return{replace:!0,templateUrl:"templates/directives/nl-random-album.html",restrict:"E",scope:{date:"@",link:"@",title:"@",currentRandom:"@"},link:function(a,b,c,d){var e=d.assignNumber();a.isActive=function(){var a=d.getCurrentRandom()%d.getCounter()===e;return a}},require:"^nlRandomGroup"}}),angular.module("nashaLeptaApp").controller("GalleryLightboxCtrl",["$scope","Lightbox",function(a,b){a.openLightboxModal=function(c){b.keyboardNavEnabled=!0,b.openModal(a.photoObjects,c)}}]),angular.module("nashaLeptaApp").directive("popUp",function(){return{replace:!0,templateUrl:"templates/directives/pop-up.html",scope:{src:"@",width:"@",height:"@"},restrict:"C",link:function(a,b,c){},controller:["$scope","Lightbox",function(a,b){a.openLightboxModal=function(a){var c=[a];console.log(c),b.keyboardNavEnabled=!1,b.openModal(c,0)}}]}}),angular.module("nashaLeptaApp").factory("FireObjects",["FirebaseLink","$firebaseArray","$firebaseObject",function(a,b,c){return{all:function(c){var d=new Firebase(a+"/"+c+"/");return b(d)},find:function(b,d){var e=new Firebase(a+"/"+b+"/"+d);return c(e)},update:function(a){console.log("FireObjectsFactory: update method is blocked, use .$save() on $firebaseObject\nDetails on https://www.firebase.com/docs/web/libraries/angular/api.html#angularfire-firebaseobject-save")},create:function(b,d){var e=new Firebase(a+"/"+b+"/"+d);return c(e)},findSingle:function(b){var d=new Firebase(a+"/"+b);return c(d)}}}]),angular.module("nashaLeptaApp").factory("ModelCopier",function(){function a(a,b){for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c])}return a});var reformalOptions={project_id:972997,project_host:"nasha-lepta.reformal.ru",tab_orientation:"left",tab_indent:"50%",tab_bg_color:"#F05A00",tab_border_color:"#FFFFFF",tab_image_url:"https://tab.reformal.ru/0JjQtNC10Lgg0Lgg0L%252FRgNC10LTQu9C%252B0LbQtdC90LjRjw==/FFFFFF/cc80218e3bc37332f1821af78c238ad8/left/1/tab.png",tab_border_width:2};!function(){var a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src=("https:"==document.location.protocol?"https://":"http://")+"media.reformal.ru/widgets/v3/reformal.js",document.getElementsByTagName("head")[0].appendChild(a)}(),angular.module("nashaLeptaApp").controller("ArticlesCreateCtrl",["$scope","FireObjects","SubProjectPrefixer","ModelCopier",function(a,b,c,d){a.article={id:"fill-me",body:"Текст для вставки"};var e=c("articles");a.articleModelsLocation=e,a.updateArticle=function(c){a.errors=null,a.article.updating=!0,a.article.status=null,b.find(e,c.id).$loaded().then(function(b){d(c,b),b.$save(),a.article.updating=null,a.article.status="Saved"},function(b){a.errors=[b],a.article.updating=null,a.article.status="Error"})}}]),angular.module("nashaLeptaApp").controller("ArticlesUpdateCtrl",["$scope","$routeParams","FireObjects","SubProjectPrefixer",function(a,b,c,d){var e=d("articles");a.articleModelsLocation=e,c.find(e,b.id).$loaded().then(function(b){a.article=b,a.article.updating=null},function(b){a.errors=[b]}),a.updateArticle=function(b){a.article.updating=!0,a.article.status=null,a.article.$save().then(function(b){a.article.updating=null,a.article.status="Saved"},function(b){a.article.updating=null,a.article.status="Error",a.errors=[b]})},a.removeArticle=function(){a.article.removing=!0,a.article.$remove().then(function(b){a.article.removing=null,a.changeRoute("#/"+e)},function(b){a.article.removing=null,console.log("ArticlesUpdateCtrl#removeArticle: "+b)})},a.changeRoute=function(b,c){a=a||angular.element(document).scope(),c||a.$$phase?window.location=b:($location.path(b),a.$apply())}}]),angular.module("nashaLeptaApp").controller("ArticlesListCtrl",["$scope","FireObjects","SubProjectPrefixer",function(a,b,c){var d=c("articles");a.articleModelsLocation=d,a.articles=b.all(d)}]),angular.module("nashaLeptaApp").controller("ArticlesShowCtrl",["$scope","$routeParams","FireObjects","SubProjectPrefixer","IsNeedToCompileFurther","$sce",function(a,b,c,d,e,f){var g=d("articles");a.articleModelsLocation=g,c.find(g,b.id).$loaded().then(function(b){var c=b.body;e(c)?(a.toShow=null,a.toShowCompile=c):(a.toShow=f.trustAsHtml(c),a.toShowCompile=null),a.article=b},function(a){console.error("ArticlesShowCtrl Error:",a)})}]),angular.module("nashaLeptaApp").factory("IsNeedToCompileFurther",function(){return function(a){return a.indexOf("picasa=")>0||a.indexOf("ng-")>0||a.indexOf("pop-up")>0}}),angular.module("nashaLeptaApp").directive("nlEditor",function(){return{templateUrl:"templates/directives/nl-editor.html",controller:"NlEditorCtrl",restrict:"E",scope:{data:"="}}}),angular.module("nashaLeptaApp").controller("NlEditorCtrl",["$scope","editorOptions","$sce","IsNeedToCompileFurther",function(a,b,c,d){a.editorOptions=b,a.isPreview=!1;var e=a.data;e&&d(e)?(a.toShow=null,a.toShowCompile=e):(a.toShow=c.trustAsHtml(e),a.toShowCompile=null),a.edit=function(){a.isPreview=!1},a.preview=function(){a.isPreview=!0;var b=a.data;d(b)?(a.toShow=null,a.toShowCompile=b):(a.toShow=c.trustAsHtml(b),a.toShowCompile=null)}}]),angular.module("nashaLeptaApp").controller("AlbumsListCtrl",["$scope","FireObjects","SubProjectPrefixer",function(a,b,c){var d=c("albums");a.albumModelsLocation=d,a.albums=b.all(d)}]),angular.module("nashaLeptaApp").controller("AlbumsCreateCtrl",["$scope","FireObjects","SubProjectPrefixer","ModelCopier",function(a,b,c,d){var e=c("albums");a.albumModelsLocation=e,a.album={id:"fill-me",title:"Заглавие альбома",cover:"https://lh3.googleusercontent.com/-Tpmm-JpPCH0/VKmwumMSD1I/AAAAAAAAHJ0/54lfCYAfR6Y1Pit_Q8S_SY74uo-DQ6HJQCHM/s912/NCH_5461.jpg",date:new Date,picasaLink:"https://picasaweb.google.com/data/feed/base/user/111442129617636727768/albumid/6100601476767132305"},a.updateAlbum=function(c){a.errors=null,a.album.updating=!0,a.album.status=null,b.find(e,c.id).$loaded().then(function(b){d(c,b),b.date=a.album.date.getTime(),b.$save(),a.album.updating=null,a.album.status="Saved"},function(b){a.errors=[b],a.album.updating=null,a.album.status="Error"})}}]),angular.module("nashaLeptaApp").controller("AlbumsShowCtrl",["$scope","$routeParams","FireObjects","SubProjectPrefixer",function(a,b,c,d){var e=d("albums");a.albumModelsLocation=e,c.find(e,b.id).$loaded().then(function(b){a.album=b,a.album.date=new Date(b.date)},function(a){console.error("AlbumsShowCtrl Error:",a)})}]),angular.module("nashaLeptaApp").controller("AlbumsUpdateCtrl",["$scope","$routeParams","FireObjects","SubProjectPrefixer",function(a,b,c,d){var e=d("albums");a.albumModelsLocation=e,c.find(e,b.id).$loaded().then(function(b){a.album=b,a.album.updating=null,a.album.date=new Date(b.date)},function(b){a.errors=[b]}),a.updateAlbum=function(b){a.album.updating=!0,a.album.status=null,a.album.date=a.album.date.getTime(),a.album.$save().then(function(b){a.album.date=new Date(b.date),a.album.updating=null,a.album.status="Saved"},function(b){a.album.date=new Date(a.album.date),a.album.updating=null,a.album.status="Error",a.errors=[b]})},a.removeAlbum=function(){a.album.removing=!0,a.album.$remove().then(function(b){a.album.removing=null,a.changeRoute("#/"+e)},function(b){a.album.removing=null,console.log("AlbumsUpdateCtrl#removeAlbum: "+b)})},a.changeRoute=function(b,c){a=a||angular.element(document).scope(),c||a.$$phase?window.location=b:($location.path(b),a.$apply())}}]),angular.module("nashaLeptaApp").controller("NewsListCtrl",["$scope","FireObjects","SubProjectPrefixer","model",function(a,b,c,d){var e=c(d);a.noveltyModelsLocation=e,a.news=b.all(e)}]),angular.module("nashaLeptaApp").controller("NewsCreateCtrl",["$scope","FireObjects","SubProjectPrefixer","ModelCopier","htmlToPlainText","model","youtubeEmbedUtils",function(a,b,c,d,e,f,g){a.novelty={id:"fill-me",summary:"краткое содержание новости",cover:"https://lh3.googleusercontent.com/-Tpmm-JpPCH0/VKmwumMSD1I/AAAAAAAAHJ0/54lfCYAfR6Y1Pit_Q8S_SY74uo-DQ6HJQCHM/s912/NCH_5461.jpg",date:new Date,body:"Текст новости"},a.youtubeEmbedUtils=g;var h=c(f);a.noveltyModelsLocation=h,a.updateNovelty=function(c){a.errors=null,a.novelty.updating=!0,a.novelty.status=null,b.find(h,c.id).$loaded().then(function(b){d(c,b),b.date=a.novelty.date.getTime(),b.$save(),a.novelty.updating=null,a.novelty.status="Saved"},function(b){a.errors=[b],a.novelty.updating=null,a.novelty.status="Error"})},a.createSummaryFromBody=function(){a.novelty.summary=e(a.novelty.body)}}]),angular.module("nashaLeptaApp").controller("NewsShowCtrl",["$scope","$routeParams","FireObjects","SubProjectPrefixer","IsNeedToCompileFurther","$sce","model",function(a,b,c,d,e,f,g){var h=d(g);a.noveltyModelsLocation=h,c.find(h,b.id).$loaded().then(function(b){var c=b.body;e(c)?(a.toShow=null,a.toShowCompile=c):(a.toShow=f.trustAsHtml(c),a.toShowCompile=null),a.novelty=b},function(a){console.error("NewsShowCtrl Error:",a)})}]),angular.module("nashaLeptaApp").controller("NewsUpdateCtrl",["$scope","$routeParams","FireObjects","SubProjectPrefixer","htmlToPlainText","model","youtubeEmbedUtils",function(a,b,c,d,e,f,g){a.youtubeEmbedUtils=g;var h=d(f);a.noveltyModelsLocation=h,c.find(h,b.id).$loaded().then(function(b){a.novelty=b,a.novelty.updating=null,a.novelty.date=new Date(b.date)},function(b){a.errors=[b]}),a.updateNovelty=function(b){a.novelty.updating=!0,a.novelty.status=null,a.novelty.date=a.novelty.date.getTime(),a.novelty.$save().then(function(b){a.novelty.date=new Date(b.date),a.novelty.updating=null,a.novelty.status="Saved"},function(b){a.novelty.date=new Date(a.novelty.date),a.novelty.updating=null,a.novelty.status="Error",a.errors=[b]})},a.removeNovelty=function(){a.novelty.removing=!0,a.novelty.$remove().then(function(b){a.novelty.removing=null,a.changeRoute("#/"+h)},function(b){a.novelty.removing=null,console.log("NoveltysUpdateCtrl#removeNovelty: "+b)})},a.changeRoute=function(b,c){a=a||angular.element(document).scope(),c||a.$$phase?window.location=b:($location.path(b),a.$apply())},a.createSummaryFromBody=function(){a.novelty.summary=e(a.novelty.body)}}]),angular.module("nashaLeptaApp").controller("ExternalsListCtrl",["$scope","FireObjects","SubProjectPrefixer",function(a,b,c){var d=c("externals");a.externalModelsLocation=d,a.externals=b.all(d)}]),angular.module("nashaLeptaApp").controller("ExternalsCreateCtrl",["$scope","FireObjects","SubProjectPrefixer","ModelCopier","youtubeEmbedUtils",function(a,b,c,d,e){a.youtubeEmbedUtils=e,a.external={id:"fill-me",summary:"краткое содержание в сми",cover:"https://lh3.googleusercontent.com/-Tpmm-JpPCH0/VKmwumMSD1I/AAAAAAAAHJ0/54lfCYAfR6Y1Pit_Q8S_SY74uo-DQ6HJQCHM/s912/NCH_5461.jpg",date:new Date,reference:"http://pravlife.org/content/protoierey-vladimir-kostochka-milostyu-bozhiey-chudotvornyh-ikon-stanovitsya-bolshe"};var f=c("externals");a.externalModelsLocation=f,a.updateNovelty=function(c){a.errors=null,a.external.updating=!0,a.external.status=null,b.find(f,c.id).$loaded().then(function(b){d(c,b),b.date=a.external.date.getTime(),b.$save(),a.external.updating=null,a.external.status="Saved"},function(b){a.errors=[b],a.external.updating=null,a.external.status="Error"})}}]),angular.module("nashaLeptaApp").controller("ExternalsUpdateCtrl",["$scope","$routeParams","FireObjects","SubProjectPrefixer","htmlToPlainText","youtubeEmbedUtils",function(a,b,c,d,e,f){a.youtubeEmbedUtils=f;var g=d("externals");a.externalModelsLocation=g,c.find(g,b.id).$loaded().then(function(b){a.external=b,a.external.updating=null,a.external.date=new Date(b.date)},function(b){a.errors=[b]}),a.updateNovelty=function(b){a.external.updating=!0,a.external.status=null,a.external.date=a.external.date.getTime(),a.external.$save().then(function(b){a.external.date=new Date(b.date),a.external.updating=null,a.external.status="Saved"},function(b){a.external.date=new Date(a.external.date),a.external.updating=null,a.external.status="Error",a.errors=[b]})},a.removeNovelty=function(){a.external.removing=!0,a.external.$remove().then(function(b){a.external.removing=null,a.changeRoute("#/"+g)},function(b){a.external.removing=null,console.log("NoveltysUpdateCtrl#removeNovelty: "+b)})},a.changeRoute=function(b,c){a=a||angular.element(document).scope(),c||a.$$phase?window.location=b:($location.path(b),a.$apply())},a.createSummaryFromBody=function(){a.external.summary=e(a.external.body)}}]),angular.module("nashaLeptaApp").factory("htmlToPlainText",function(){return function(a){return a=a?String(a).replace(/<[^>]+>/gm," "):"",a=a?String(a).replace(/&nbsp;/gm,""):""}}),angular.module("nashaLeptaApp").factory("modelGrouper",function(){return function(a,b){var c,d,e=[];for(c=0;c<a.length;c+=b){var f=[];for(d=0;b>d&&a[c+d];d++)f.push(a[c+d]);e.push(f)}return e}}),angular.module("nashaLeptaApp").controller("LandingCtrl",["$scope","FireObjects","SubProjectPrefixer","modelGrouper","$uibModal","$filter","$log","GroupQtyResizer","$window",function(a,b,c,d,e,f,g,h,i){var j=h.getQty(i.innerWidth),k=c("slides");a.slideModelsLocation=k,a.slides=b.all(k);var l=c("albums");a.albumModelsLocation=l,a.albums=b.all(l),a.$watch("albums",function(b){a.albumGroups=d(b,j)},!0);var m=c("video-gallery");a.videoGallery=b.findSingle(m),a.$watch("videoGallery",function(b){a.videoGroups=d(b.data,j)},!0),a.open=function(a){e.open({animation:!0,template:'<div class="embed-responsive embed-responsive-16by9"><youtube-video class="embed-responsive-item" video-id="video.youtubeId" player-vars="playerVars"></youtube-video></div>',controller:"ModalInstanceCtrl",size:"lg",resolve:{video:function(){return a}}})};var n=c("news");a.noveltyModelsLocation=n,a.news=[],b.all(n).$loaded().then(function(b){b=f("orderBy")(b,"-date"),a.news=b.slice(0,3)},function(a){g.error("LandingCtrl#FireObjects.all(news): "+a)})}]),angular.module("nashaLeptaApp").controller("SlidesListCtrl",["$scope","FireObjects","SubProjectPrefixer","$log",function(a,b,c,d){a.slides=[{buttonName:"Помочь...",cover:"images/slides/children_day.f1eca941.jpg",description:"Добрых дел много не бывает))",detailsLink:"#/requisites",id:"0",title:"Наша цель - помощь детям!"},{buttonName:"Подробнее...",cover:"images/slides/mitropolit.5104107d.jpg",description:"Благотворительный проект «Наша Лепта» создан по благословению  Блаженнейшего Митрополита Киевского и всей Украины Онуфрия и действует на базе храма святителя Николая Чудотворца при 17-й больнице города Киева.",detailsLink:"#/about",id:"1",title:'"Наша Лепта"'}];var e=c("slides");a.slideModelsLocation=e,b.all(e).$loaded().then(function(b){var c=a.slides.concat(b);a.slides=c},function(a){d.error("SlidesListCtrl#FireObjects.all: "+a)})}]),angular.module("nashaLeptaApp").controller("SlidesCreateCtrl",["$scope","FireObjects","SubProjectPrefixer","ModelCopier",function(a,b,c,d){a.slide={id:"fill-me",title:"Заглавие слайда",description:"Описание слайда",buttonName:"Надпись на кнопке",cover:"images/slides/children_day.f1eca941.jpg",detailsLink:"#/news"};var e=c("slides");a.slideModelsLocation=e,a.updateSlide=function(c){a.errors=null,a.slide.updating=!0,a.slide.status=null,b.find(e,c.id).$loaded().then(function(b){d(c,b),b.$save(),a.slide.updating=null,a.slide.status="Saved"},function(b){a.errors=[b],a.slide.updating=null,a.slide.status="Error"})}}]),angular.module("nashaLeptaApp").controller("SlidesShowCtrl",["$scope","$routeParams","FireObjects","SubProjectPrefixer",function(a,b,c,d){var e=d("slides");a.slideModelsLocation=e,c.find(e,b.id).$loaded().then(function(b){a.slide=b},function(a){console.error("SlidesShowCtrl Error:",a)})}]),angular.module("nashaLeptaApp").controller("SlidesUpdateCtrl",["$scope","$routeParams","FireObjects","SubProjectPrefixer",function(a,b,c,d){var e=d("slides");a.slideModelsLocation=e,c.find(e,b.id).$loaded().then(function(b){a.slide=b,a.slide.updating=null},function(b){a.errors=[b]}),a.updateSlide=function(b){a.slide.updating=!0,a.slide.status=null,a.slide.$save().then(function(b){a.slide.updating=null,a.slide.status="Saved"},function(b){a.slide.updating=null,a.slide.status="Error",a.errors=[b]})},a.removeSlide=function(){a.slide.removing=!0,a.slide.$remove().then(function(b){a.slide.removing=null,a.changeRoute("#/"+e)},function(b){a.slide.removing=null,console.log("SlidesUpdateCtrl#removeSlide: "+b)})},a.changeRoute=function(b,c){a=a||angular.element(document).scope(),c||a.$$phase?window.location=b:($location.path(b),a.$apply())}}]),angular.module("nashaLeptaApp").controller("VideoGalleryListCtrl",["$scope","FireObjects","SubProjectPrefixer","$uibModal",function(a,b,c,d){var e=c("video-gallery");a.videoModelsLocation=e,a.videoGallery=b.findSingle(e),a.open=function(a){d.open({animation:!0,template:'<div class="embed-responsive embed-responsive-16by9"><youtube-video class="embed-responsive-item" video-id="video.youtubeId" player-vars="playerVars"></youtube-video></div>',controller:"ModalInstanceCtrl",size:"lg",resolve:{video:function(){return a}}})}}]),angular.module("nashaLeptaApp").controller("VideoGalleryUpdateCtrl",["$scope","PlaylistFetcher","YoutubeListResponseConverter","FireObjects","SubProjectPrefixer","PlayListIdExtractor",function(a,b,c,d,e,f){var g=e("video-gallery");a.videoModelsLocation=g,a.videoGallery=d.findSingle(g),a.fetchYoutubeData=function(){a.errors=null,a.fetching=!0,a.status=null;var d=f(a.videoGallery.playlistUrl);"nope"===d?(a.errors?a.errors.push("Incorrect URL of playlist used: "+a.videoGallery.playlistUrl):a.errors=["Incorrect URL of playlist used: "+a.videoGallery.playlistUrl],a.fetching=null,a.status="Fetching error"):b(d).then(function(b){a.fetching=null,a.status="Fetched",a.videoGallery.data=c(b.data)},function(b){a.errors?a.errors.push(b):a.errors=[b],a.fetching=null,a.status="Error"})},a.updateVideoGallery=function(){a.errors=null,a.updating=!0,a.status=null,a.videoGallery.$save().then(function(b){a.updating=null,a.status="Saved"},function(b){a.updating=null,a.status="Error",a.errors?a.errors.push(b):a.errors=[b]})}}]),angular.module("nashaLeptaApp").constant("YoutubeKeyHolder","AIzaSyC9_SO9SJVGy5opqW435d3S80ehYkmfDC8"),angular.module("nashaLeptaApp").constant("FlickrKeyHolder","8363b2b29cfcebd78bd96138f4d4df83"),angular.module("nashaLeptaApp").factory("YoutubeListResponseConverter",function(){return function(a){return a.items.map(function(a,b,c){return{youtubeId:a.snippet.resourceId.videoId,publishedAt:a.snippet.publishedAt,title:a.snippet.title,thumbnailUrl:a.snippet.thumbnails.high.url}})}}),angular.module("nashaLeptaApp").factory("PlaylistFetcher",["$http","YoutubeKeyHolder",function(a,b){return function(c){return a({method:"GET",url:"https://www.googleapis.com/youtube/v3/playlistItems",params:{part:"snippet",playlistId:c,key:b,maxResults:50}})}}]),angular.module("nashaLeptaApp").factory("FlickrAlbumFetcher",["$http","FlickrKeyHolder",function(a,b){return function(c){return a({method:"GET",url:"https://api.flickr.com/services/rest/",params:{method:"flickr.photosets.getPhotos",photoset_id:c,api_key:b,format:"json",nojsoncallback:1}})}}]),angular.module("nashaLeptaApp").controller("ModalInstanceCtrl",["$scope","video",function(a,b){a.video=b,a.playerVars={autoplay:1}}]),angular.module("nashaLeptaApp").factory("PlayListIdExtractor",function(){function a(a){var b=/^(?:https?:\/\/)?(?:www\.)?youtube\.com(?:\S+)?$/;return a.match(b)&&a.match(b).length>0}return function(b){var c=new RegExp("[&?]list=([a-z0-9_-]+)","i"),d=c.exec(b);return d&&d[1].length>0&&a(b)?d[1]:"nope"}}),angular.module("nashaLeptaApp").factory("SubProjectPrefixer",["$location",function(a){var b=["exposition","evenings","accounting"];return function(c){var d,e=a.path();for(d in b)if(e.indexOf(b[d])>-1)return b[d]+"/"+c;return c}}]),angular.module("nashaLeptaApp").controller("GoogleMapCtrl",["$scope","uiGmapGoogleMapApi",function(a,b){b.then(function(a){}),a.map={center:{latitude:50.427852,longitude:30.527468},draggable:!0,zoom:15,options:{scrollwheel:!0}},a.gMapMarkers=[{id:0,coords:{latitude:50.427852,longitude:30.527468},options:{draggable:!1,title:"Церква святителя Миколая Чудотворця",animation:1}}]}]),angular.module("nashaLeptaApp").factory("GroupQtyResizer",function(){return{getQty:function(a){return a>800?3:a>450?2:1}}}),angular.module("nashaLeptaApp").directive("imageOrVideoModal",function(){return{templateUrl:"templates/directives/image-or-video-modal.html",restrict:"E",scope:{data:"@"},controller:"ImageOrVideoModalCtrl"}}),angular.module("nashaLeptaApp").controller("ImageOrVideoModalCtrl",["$scope","youtubeEmbedUtils","$uibModal",function(a,b,c){var d;a.data.indexOf("youtu")>-1?(d=b.getIdFromURL(a.data),a.dirImg="https://i.ytimg.com/vi/"+d+"/hqdefault.jpg",a.open=function(){c.open({animation:!0,template:'<div class="embed-responsive embed-responsive-16by9"><youtube-video class="embed-responsive-item" video-id="video" player-vars="playerVars"></youtube-video></div>',controller:"ModalInstanceCtrl",size:"lg",resolve:{video:function(){return console.log("[ImageOrVideoModalCtrl] video: "+d),d}}})}):(a.dirImg=a.data,a.open=function(){}),a.videoId=d}]),angular.module("nashaLeptaApp").service("FlickrJsonToUrlConverter",function(){return function(a){return a.photoset.photo.map(function(a){var b="https://farm"+a.farm+".staticflickr.com/"+a.server+"/"+a.id+"_"+a.secret+"_z.jpg";return{thumb:b,thumbheight:800,thumbwidth:600,url:b}})}}),angular.module("nashaLeptaApp").service("FlickrAlbumIdExtractor",function(){return function(a){var b=/\/albums\/(\d+)/,c=b.exec(a);return c&&c[1].length>0?c[1]:""}}),angular.module("nashaLeptaApp").directive("flickr",["FlickrAlbumIdExtractor","FlickrAlbumFetcher","FlickrJsonToUrlConverter",function(a,b,c){return{templateUrl:"templates/vendor/picasa/picasa.html",restrict:"A",scope:{flickr:"@"},controller:"GalleryLightboxCtrl",link:function(d,e,f){d.$watch("flickr",function(){if(""!==d.flickr){var e=a(d.flickr);b(e).then(function(a){var b=c(a.data);d.photoObjects=b,d.current=b[0],d.ready=!0})}}),d.setCurrent=function(a){d.current=a},d.move=function(a){var b=e[0].lastElementChild,c=a.clientX-b.offsetLeft,d=b.offsetWidth/2,f=20,g=(c-d)/d*f;g>0&&b.scrollLeft<b.scrollWidth-b.clientWidth&&(b.scrollLeft+=g),0>g&&b.scrollLeft>0&&(b.scrollLeft+=g)}}}}]);